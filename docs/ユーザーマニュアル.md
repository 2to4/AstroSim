# AstroSim ユーザーマニュアル

## 目次

1. [はじめに](#はじめに)
2. [基本操作](#基本操作)
3. [インターフェース詳細](#インターフェース詳細)
4. [3D操作ガイド](#3d操作ガイド)
5. [設定とカスタマイズ](#設定とカスタマイズ)
6. [高度な機能](#高度な機能)
7. [トラブルシューティング](#トラブルシューティング)
8. [FAQ](#faq)

## はじめに

AstroSimへようこそ！このユーザーマニュアルでは、3D太陽系シミュレーターの全機能を詳しく説明します。初心者から上級者まで、AstroSimを最大限に活用するための情報を提供します。

### 初回起動時の確認事項

1. **システム要件の確認**
   - Python 3.8以上
   - OpenGL 3.3対応GPU
   - 4GB以上のメモリ

2. **必要な依存関係**
   - PyQt6 6.5.0+
   - Vispy 0.14.0+
   - NumPy, SciPy, Astropy

3. **起動コマンド**
   ```bash
   # プロジェクトルートディレクトリから実行
   python -m src.main
   
   # または直接実行
   python src/main.py
   ```

## 基本操作

### アプリケーションの起動

1. コマンドプロンプト・ターミナルを開く
2. AstroSimフォルダに移動
3. 以下のいずれかのコマンドを実行:
   ```bash
   python -m src.main
   # または
   python src/main.py
   ```
4. メインウィンドウが表示されるまで待機（通常2-5秒）

**注意**: 
- 初回起動時はPyQt6とVispyの初期化に時間がかかる場合があります
- エラーが発生した場合は、依存関係が正しくインストールされているか確認してください

### 基本的な画面構成

```
┌─────────────────────────────────────────────────────────────┐
│ File  View  Simulation  Help                  [_ □ ×]       │
├─────────────────────────────────────────────────────────────┤
│ [▶] [⏹] [↻]                                               │
├─────────────────────────────────────────────────────────────┤
│                          │ ┌─ 制御パネル ─┐                │
│        3D表示領域        │ │ ⏸ Play      │                │
│                          │ │ ⏩ Speed: 1x │                │
│       🌞                 │ │ 📅 Date     │                │
│    🌍    🔴              │ └─────────────┘                │
│                          │ ┌─ 情報パネル ─┐                │
│                          │ │ 選択: 地球   │                │
│                          │ │ 質量: 5.97E24│                │
│                          │ │ 半径: 6371km │                │
│                          │ └─────────────┘                │
├─────────────────────────────────────────────────────────────┤
│ 時刻: 2024-01-01 12:00:00 UTC  x1.0        [Ready]        │
└─────────────────────────────────────────────────────────────┘
```

### 初期表示の理解

起動直後、以下が表示されます：

- **太陽**: 中央の黄色い球体
- **8惑星**: 水星、金星、地球、火星、木星、土星、天王星、海王星
- **軌道線**: 各惑星の楕円軌道（白い線）
- **惑星ラベル**: 各惑星の名前
- **座標軸**: X（赤）、Y（緑）、Z（青）軸

## インターフェース詳細

### メニューバー

#### ファイルメニュー
- **太陽系データを開く (Ctrl+O)**: カスタム太陽系データの読み込み
- **画像として保存 (Ctrl+S)**: 現在のシーンをPNG/JPEG形式で保存
- **終了 (Ctrl+Q)**: アプリケーションの終了

#### 表示メニュー
- **フルスクリーン (F11)**: フルスクリーン表示の切り替え
- **ビューリセット (R)**: カメラ位置を初期状態に戻す

#### シミュレーションメニュー
- **再生/一時停止 (Space)**: アニメーションの制御
- **リセット (Ctrl+R)**: 時間をJ2000.0 epoch（2000年1月1日）にリセット

#### ヘルプメニュー
- **キーボードショートカット**: ショートカット一覧の表示
- **AstroSimについて**: バージョン情報とクレジット

### ツールバー

| アイコン | 機能 | ショートカット |
|----------|------|----------------|
| ▶ | 再生/一時停止 | Space |
| ⏹ | 停止・リセット | Ctrl+R |
| ↻ | ビューリセット | R |

### 制御パネル

#### アニメーション制御
- **再生/一時停止ボタン**: シミュレーションの開始・停止
- **時間倍率スライダー**: 0.1倍〜100倍でアニメーション速度調整
- **日時表示**: 現在のシミュレーション時刻

#### 表示オプション
- **軌道線表示**: 惑星軌道の表示/非表示切り替え
- **ラベル表示**: 惑星名の表示/非表示切り替え
- **追跡モード**: 選択した惑星にカメラが追従

#### 惑星選択
- **惑星ボタン**: 各惑星のクイック選択
- **フォーカス**: 選択した惑星を画面中央に表示

### 情報パネル

選択した惑星の詳細情報を表示：

- **基本情報**
  - 名前
  - 質量（kg）
  - 半径（km）
  - 平均密度（g/cm³）

- **軌道情報**
  - 軌道長半径（AU）
  - 離心率
  - 軌道周期（日）
  - 軌道傾斜角（度）

- **現在状態**
  - 太陽からの距離（AU）
  - 現在位置（X, Y, Z座標）
  - 軌道速度（km/s）

## 3D操作ガイド

### マウス操作

#### カメラ回転（左ドラッグ）
1. マウス左ボタンを押下したまま移動
2. **水平移動**: 方位角変更（太陽系を左右に回転）
3. **垂直移動**: 仰角変更（上下視点変更）
4. **操作範囲**: 全方位360度

**操作のコツ**:
- ゆっくりドラッグすると滑らかな回転
- 素早い操作で慣性スクロール
- Shiftキー同時押しで微調整モード

#### カメラパン（右ドラッグ）
1. マウス右ボタンを押下したまま移動
2. **視点移動**: カメラ位置を平行移動
3. **用途**: 特定の領域にフォーカス

**操作のコツ**:
- 惑星を画面中央に配置
- 軌道の特定部分を詳細観察
- 複数の惑星を同時に画面内に収める

#### ズーム（ホイール）
1. マウスホイールを前後に回転
2. **ホイール前回転**: ズームイン（近づく）
3. **ホイール後回転**: ズームアウト（遠ざかる）
4. **ズーム範囲**: 0.1AU〜1000AU

**ズームレベルの目安**:
- **0.1-1 AU**: 内惑星（水星〜火星）の詳細観察
- **1-10 AU**: 太陽系全体の概観
- **10-50 AU**: 外惑星（木星〜海王星）を含む広域表示
- **50+ AU**: 太陽系外縁の俯瞰

#### オブジェクト選択（左クリック）
1. 惑星を左クリック
2. 選択された惑星がハイライト表示
3. 情報パネルに詳細情報表示
4. 空白部分をクリックで選択解除

**選択のコツ**:
- 惑星が小さい場合はズームインしてから選択
- ラベル部分でも選択可能
- 重なっている場合は手前の惑星が優先

### キーボードショートカット詳細

#### アニメーション制御
| キー | 機能 | 詳細 |
|------|------|------|
| `Space` | 再生/一時停止 | 現在の状態を切り替え |
| `Ctrl+Space` | 強制一時停止 | 再生中でも必ず停止 |

#### 視点制御
| キー | 機能 | 詳細 |
|------|------|------|
| `R` | ビューリセット | 初期カメラ位置に戻る |
| `1` | 上面ビュー | XY平面を上から見下ろす |
| `2` | 側面ビュー | XZ平面を横から見る |
| `3` | 正面ビュー | YZ平面を正面から見る |
| `4` | 透視図ビュー | 3次元的な斜め視点 |

#### 表示制御
| キー | 機能 | 詳細 |
|------|------|------|
| `O` | 軌道線切り替え | 軌道の表示/非表示 |
| `L` | ラベル切り替え | 惑星名の表示/非表示 |
| `G` | グリッド切り替え | 距離グリッドの表示/非表示 |
| `A` | 軸表示切り替え | 座標軸の表示/非表示 |

#### 惑星選択・追跡
| キー | 機能 | 詳細 |
|------|------|------|
| `5` | 水星選択 | 水星にフォーカス |
| `6` | 金星選択 | 金星にフォーカス |
| `7` | 地球選択 | 地球にフォーカス |
| `8` | 火星選択 | 火星にフォーカス |
| `9` | 木星選択 | 木星にフォーカス |
| `0` | 土星選択 | 土星にフォーカス |
| `Escape` | 追跡停止 | カメラ追跡モード解除 |

#### システム操作
| キー | 機能 | 詳細 |
|------|------|------|
| `F1` | ヘルプ表示 | 操作方法のダイアログ |
| `F5` | 画面更新 | 表示の強制リフレッシュ |
| `F11` | フルスクリーン | 全画面表示の切り替え |
| `Ctrl+R` | シミュレーションリセット | 時間をエポックに戻す |
| `Ctrl+Q` | 終了 | アプリケーション終了 |

## 設定とカスタマイズ

### 表示設定の詳細調整

#### 軌道線設定
- **表示/非表示**: Oキーまたは制御パネル
- **色の変更**: 設定ファイル（config.json）で調整可能
- **線の太さ**: パフォーマンスに応じて自動調整

#### ラベル設定
- **表示/非表示**: Lキーまたは制御パネル
- **フォントサイズ**: 画面解像度に応じて自動調整
- **表示位置**: 惑星の右上に固定

#### スケール設定
- **惑星サイズ**: 実スケールまたは誇張表示
- **距離スケール**: 実スケールまたは圧縮表示
- **自動調整**: ズームレベルに応じた最適化

### アニメーション設定

#### 時間倍率の調整
- **0.1倍**: 超スローモーション（詳細観察用）
- **1倍**: リアルタイム
- **10倍**: 高速観察
- **100倍**: 長期間の軌道変化観察

#### 時間の設定
- **開始日時**: デフォルトはJ2000.0 (2000-01-01 12:00:00 UTC)
- **時間進行**: 前進のみ（逆再生は未対応）
- **精度**: 秒単位での正確な時間管理

### パフォーマンス設定

#### 描画品質
- **高品質**: 32分割球体、フル機能（推奨距離2AU以内）
- **中品質**: 16分割球体、標準機能（推奨距離10AU以内）
- **低品質**: 8分割球体、基本機能（推奨距離50AU以内）

#### メモリ最適化
- **オブジェクトプール**: 自動的にリソース再利用
- **フラスタムカリング**: 画面外オブジェクトの描画スキップ
- **レベル・オブ・ディテール**: 距離に応じた詳細度調整

## 高度な機能

### 追跡モード

#### 惑星追跡の設定
1. 惑星を選択（クリックまたは数字キー）
2. 制御パネルの「追跡」ボタンをクリック
3. カメラが選択した惑星に追従

#### 追跡モードの種類
- **固定追跡**: 惑星を画面中央に固定
- **軌道追跡**: 惑星の軌道運動に合わせてカメラ移動
- **相対追跡**: 惑星を基準とした相対座標系

#### 追跡の解除
- `Escape`キーを押す
- 制御パネルの「追跡停止」ボタン
- 別の惑星を選択

### プリセットビュー

#### 定型視点の活用
- **太陽系全体**: 全惑星を画面内に収める
- **内惑星**: 水星〜火星の詳細観察
- **外惑星**: 木星〜海王星の広域表示
- **軌道平面**: 各惑星の軌道面を正面から

#### カスタムビューの保存
現在の視点を保存・復元する機能（将来実装予定）

### データエクスポート

#### 画像出力
- **形式**: PNG、JPEG
- **解像度**: 1920×1080（フルHD）
- **用途**: プレゼンテーション、レポート作成

#### 軌道データ出力
- **形式**: CSV、JSON
- **内容**: 位置、速度、時刻データ
- **用途**: 科学的分析、他ソフトとの連携

## トラブルシューティング

### 起動時の問題

#### アプリケーションが起動しない
**症状**: Pythonコマンド実行後にエラーメッセージ

**原因と対処法**:
1. **Python バージョン確認**
   ```bash
   python --version
   # Python 3.8.0以上であることを確認
   ```

2. **依存関係の確認**
   ```bash
   pip list | grep -E "(PyQt6|vispy|numpy)"
   # 必要なパッケージがインストールされているか確認
   ```

3. **再インストール**
   ```bash
   pip install -r requirements.txt --force-reinstall
   ```

#### インポートエラー
**症状**: `ModuleNotFoundError: No module named 'src'`

**対処法**:
```bash
# プロジェクトルートディレクトリで実行
python -m src.main

# または
export PYTHONPATH="${PYTHONPATH}:$(pwd)"
python src/main.py
```

### 描画・表示の問題

#### 3D表示が正常でない
**症状**: 黒い画面、オブジェクトが表示されない

**原因と対処法**:
1. **OpenGL ドライバの更新**
   - グラフィックカードメーカーの最新ドライバをインストール
   - OpenGL 3.3以上の対応確認

2. **GPU 設定の確認**
   ```bash
   # OpenGL バージョン確認
   python -c "from vispy import gloo; print(gloo.gl.glGetString(gloo.gl.GL_VERSION))"
   ```

3. **統合グラフィック使用時**
   - NVIDIA/AMD の専用GPU を使用するよう設定変更
   - 「高パフォーマンスGPU」を選択

#### パフォーマンスが悪い
**症状**: フレームレートが低い、動作が重い

**対処法**:
1. **表示品質の調整**
   - 軌道線を非表示（Oキー）
   - ラベルを非表示（Lキー）
   - ウィンドウサイズを縮小

2. **アニメーション速度の調整**
   - 時間倍率を下げる（0.5倍以下）
   - 一時停止して静的観察

3. **システムリソースの確認**
   ```bash
   # メモリ使用量確認
   python -c "import psutil; print(f'Memory: {psutil.virtual_memory().percent}%')"
   ```

### 操作・機能の問題

#### マウス操作が効かない
**症状**: ドラッグ、クリックが反応しない

**対処法**:
1. **フォーカス確認**: 3D表示領域をクリックしてフォーカス
2. **マウスドライバ**: 最新ドライバに更新
3. **操作モード**: 現在のモードを確認（追跡中など）

#### 惑星選択ができない
**症状**: クリックしても惑星が選択されない

**対処法**:
1. **ズーム調整**: ズームインして惑星を大きく表示
2. **ラベル選択**: 惑星名のラベル部分をクリック
3. **キーボード選択**: 数字キー（5-9）で直接選択

#### アニメーションが停止する
**症状**: 途中でアニメーションが止まる

**対処法**:
1. **メモリ不足**: 他のアプリケーションを終了
2. **例外発生**: ログファイル（logs/error.log）を確認
3. **リセット**: Ctrl+R でシミュレーションリセット

### ログとデバッグ

#### ログファイルの場所
```
logs/
├── AstroSim.log          # 一般的な動作ログ
├── errors/error.log      # エラー・例外ログ
├── debug/debug.log       # デバッグ情報
└── performance/performance.log  # パフォーマンス統計
```

#### よくあるエラーメッセージ

1. **GPU利用不可**
   ```
   ERROR: GPU acceleration unavailable, falling back to software rendering
   ```
   → グラフィックドライバを更新

2. **メモリ不足**
   ```
   WARNING: High memory usage detected, enabling memory optimization
   ```
   → 他のアプリケーションを終了、表示品質を下げる

3. **依存関係エラー**
   ```
   ERROR: Failed to import required module
   ```
   → `pip install -r requirements.txt --force-reinstall`

## FAQ

### Q1: 実際の惑星データを使用していますか？

A: はい。NASA JPL（ジェット推進研究所）の正確な軌道要素データを使用しています。軌道長半径、離心率、軌道傾斜角などは実測値に基づいています。

### Q2: 軌道計算の精度はどの程度ですか？

A: ケプラー軌道の計算精度は非常に高く、1年間の軌道で誤差は0.001 AU以下です。ただし、惑星間の重力相互作用（摂動）は簡略化されています。

### Q3: 過去や未来の日時にシミュレーション可能ですか？

A: 現在のバージョンでは2000年以降の未来方向のみです。過去への時間進行機能は将来実装予定です。

### Q4: 月や小惑星も表示できますか？

A: 現在は8惑星のみですが、将来のバージョンで月、小惑星、彗星の追加を予定しています。

### Q5: カスタムの天体データを追加できますか？

A: JSON形式のデータファイルで独自の天体を追加可能です。詳細は技術ドキュメントを参照してください。

### Q6: 商用利用は可能ですか？

A: MITライセンスの下で公開されているため、商用利用も可能です。ライセンス条件を遵守してご利用ください。

### Q7: 他の太陽系シミュレーターとの違いは？

A: AstroSimの特徴：
- リアルタイム3D表示
- 高度に最適化された計算エンジン
- インタラクティブな操作性
- オープンソース（カスタマイズ可能）

### Q8: システム要件を満たさない場合は？

A: 以下の代替手段があります：
- 軽量モード（表示品質を下げる）
- 静止画モード（アニメーション無効）
- コマンドライン版（GUI無し、将来実装）

### Q9: バグ報告や機能要望の方法は？

A: GitHubの Issues または Discussions をご利用ください：
- バグ報告: 再現手順とログファイルを添付
- 機能要望: 具体的な用途と期待する動作を記載

### Q10: 開発への参加方法は？

A: 以下の方法で貢献可能です：
- コードの改善・機能追加
- バグ修正
- ドキュメント改善
- テストケース追加
- 翻訳（多言語対応）

詳細は[CONTRIBUTING.md](../CONTRIBUTING.md)をご覧ください。

---

## サポート情報

**技術サポート**: 
- GitHub Issues: https://github.com/your-username/AstroSim/issues
- Discussion: https://github.com/your-username/AstroSim/discussions

**ドキュメント**:
- プロジェクト概要: README.md
- 設計資料: docs/概要設計書.md, docs/詳細設計書.md
- 開発者向け: docs/テスト計画書.md

**リリース情報**:
- 最新版: GitHub Releases
- 変更履歴: CHANGELOG.md（将来実装）

---

*このマニュアルは AstroSim v1.0.0 に基づいています。*
*最新情報は公式リポジトリをご確認ください。*